---
title: 对封装的误解
date: 2017-6-18
---

我们常常听到一些“把这段代码封装到一个类/函数/方法里”的说法，仿佛封装这个事情等同于代码重用。

然而，这绝不是封装的内涵，在绝大多数外行以及面向对象编程的新手眼中，封装就是一个“将看上去乱糟糟的房间(代码片段)整理得干干净净(类与方法)”的过程。

对他们来说，封装之后的好处主要是什么呢？下次调用的时候就很方便了。这就是所谓代码重用的原始冲动。

这有什么问题呢？

他们的“封装”等同于我们的“提炼”(Extract)，本质上仅是一类重构方法。

这是缺乏理论指导的做法，很多人仅凭直觉进行 Extract Method/Class。

不恰当的提炼重构免不了在后期反复修改。

从技术上讲，如果要从既有代码中进行真正的封装，也是要通过 提炼(Extract)、 搬运(Move) 等重构手段的。

但区别在于我们要理解封装的本质，运用设计原则来判断新的设计是否合理。

**封装通过隐藏实现细节来阻隔变化。**

封装的目的是**阻隔变化**，策略是**隐藏实现细节**。

为什么要阻隔变化？

> 要说软件中有什么不变的话，那就是“变化”本身。

众所周知，变化(变更)是软件中一个常见事情。

> 设计的一个目的是“为了应对变化”。

试想一下，对某个功能/类/方法的变更会沿着依赖关系，像洪水一样，让沿途的一切陷入瘫痪。

那么控制“变化洪流”的影响范围就是一个很好的防洪思路，这就是封装。

将封装比喻成“防洪坝”什么的还是很贴切的嘛。