---
title: 等价类划分与三角形问题
date: 2017-04-24
categories:
  - 测试
tags:
  - 等价类划分
---

> 任意输入3个不超过100的正整数作为三角形的3条边的长度，判断三角形的类型：不能构成三角形、一般三角形、等腰三角形、等边三角形。

<!--more-->

# 从输入视角划分等价类

## 识别等价类

输入只有三角形的三边，不妨设为 a, b, c:

| 编号   | 条件   | 有效等价类(V) | 无效等价类(I) |
| ---- | ---- | -------- | -------- |
| 1    | 输入边数 | 3        | 0        |
| 2    |      |          | 1        |
| 3    |      |          | 2        |
| 4    |      |          | 大于3      |
| 5    | 输入范围 | (0, 100] | 小于等于0    |
| 6    |      |          | 大于 100   |

## 设计测试用例

设计测试用例以覆盖有效等价类：

| 输入元组(a, b, c) | 期望输出  | 覆盖有效等价类      |
| ------------- | ----- | ------------ |
| (3, 4, 5)     | 一般三角形 | (V.1), (V.5) |

设计测试用例以覆盖无效等价类：

| 输入元组(a, b, c)      | 期望输出 | 覆盖无效等价类 |
| ------------------ | ---- | ------- |
| (null, null, null) | 参数错误 | (I.1)   |
| (null, null, 1)    | 参数错误 | (I.2)   |
| (null, 1, 1)       | 参数错误 | (I.3)   |
| (1, 1, 1, 1)       | 参数错误 | (I.4)   |
| (0, 0, 0)          | 参数错误 | (I.5)   |
| (101, 101, 101)    | 参数错误 | (I.6)   |

可以看出这个测试效果不咋地，由于这个问题的解决方法是用一个很“纯”的函数来实现的，特别适合从输出视角划分等价类，细节会有些不同。

# 从输出视角划分等价类

不妨设三角形的三边分别为 a, b, c:

> 如果将异常输出——参数不合法——也作为有效输出考虑，会怎么样呢？

按照输出结果划分等价类：**不能构成三角形**、**一般三角形**、**等腰三角形**、**等边三角形**以及**参数不合法**。

由于等边三角形是特殊的等腰三角形，在程序中，能输出等边三角形时，不输出等腰三角形。即等腰三角形是指非等边的等腰三角形。

类似地，参数不合法会比不能构成三角形更优先输出。

## 识别等价类

等价类划分表中有许多行的条件具有相同的文字描述，这些条件是通过**逻辑或**运算连接的，因此这本质上是一个**析取范式**。

每个情况的有效等价类条件是不能重叠的，而无效等价类条件是可以彼此重叠的。即任意给定一个输入，满足且只满足某一个情况的有效等价类条件，但可以同时满足多个情况的无效等价类条件。

以下给出利用数理逻辑方法来生成等价类划分表：

1. 输出参数不合法

   程序输出参数不合法**当且仅当** a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100，作为**有效等价类**。

   其反面为 a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100，作为**无效等价类**。

2. 输出不能构成三角形

   程序输出不能构成三角形**当且仅当** 

   a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100 且 a + b <= c 

   或

   a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100 且 b + c <= a

   或

   a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100 且 c + a <= b

   其反面为

   a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 a + b > c 

   且

   a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 b + c > a 

   且

   a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 c + a > b

   其反面化为**析取范式**为

   a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 **a + b > c 且  b + c > a 且 c + a > b**

3. 输出一般三角形

   程序输出一般三角形**当且仅当** a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100 且 a + b > c 且 a + c > b 且 b + c > a 且 a != b 且 a != c 且 b != c

   其反面为 a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 a + b <= c 或 a + c <= b 或 b + c <= a 或 a == b 或 b == c 或 c == a

4. 输出等腰三角形

   程序输出等腰三角形**当且仅当** 

   a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100 且 a + b > c 且 a + c > b 且 b + c > a 且 **a == b 且 b != c**

   或

   a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100 且 a + b > c 且 a + c > b 且 b + c > a 且 **b == c 且 c != a**

   或

   a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100 且 a + b > c 且 a + c > b 且 b + c > a 且 **c == a 且 a != b**

   反面是

   a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 a + b <= c 或 a + c <= b 或 b + c <= a 或 **a != b 或 b == c**

   且

   a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 a + b <= c 或 a + c <= b 或 b + c <= a 或 **b != c 或 c == a**

   且

   a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 a + b <= c 或 a + c <= b 或 b + c <= a 或 **c != a 或 a == b**

   这个反面条件化为**析取范式**为

   a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 a + b <= c 或 a + c <= b 或 b + c <= a 或 **a == b 且 b == c** 或 **a != b 且 b != c 且 c != a**

5. 输出等边三角形

   程序输出等腰三角形**当且仅当** a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100 且 a + b > c 且 a + c > b 且 b + c > a 且 **a == b 且 b == c**

   其反面为 a <= 0 或 a > 100 或 b <= 0 或 b > 100 或 c <= 0 或 c > 100 或 a + b <= c 或 a + c <= b 或 b + c <= a 或 **a != b 或 b != c**


通过以上分析生成等价类划分表：

| 编号   | 条件描述    | 有效等价类 (V)                                | 无效等价类 (I)                                |
| ---- | ------- | ---------------------------------------- | ---------------------------------------- |
| 1    | 参数不合法   | a <= 0                                   | a > 0 且 a <= 100 且 b > 0 且 b <= 100 且 c > 0 且 c <= 100 |
| 2    |         | a > 100                                  |                                          |
| 3    |         | b <= 0                                   |                                          |
| 4    |         | b > 100                                  |                                          |
| 5    |         | c <= 0                                   |                                          |
| 6    |         | c > 100                                  |                                          |
| 7    | 不能构成三角形 | (I.1) 且 a + b <= c                       | (V.1)                                    |
| 8    |         | (I.1) 且 b + c <= a                       | (V.2)                                    |
| 9    |         | (I.1) 且 c + a <= b                       | (V.3)                                    |
| 10   |         |                                          | (V.4)                                    |
| 11   |         |                                          | (V.5)                                    |
| 12   |         |                                          | (V.6)                                    |
| 13   |         |                                          | a + b > c 且  b + c > a 且 c + a > b       |
| 14   | 一般三角形   | (I.1) 且 (I.13) 且 a != b 且 a != c 且 b != c | (V.1)                                    |
| 15   |         |                                          | (V.2)                                    |
| 16   |         |                                          | (V.3)                                    |
| 17   |         |                                          | (V.4)                                    |
| 18   |         |                                          | (V.5)                                    |
| 19   |         |                                          | (V.6)                                    |
| 20   |         |                                          | a + b <= c                               |
| 21   |         |                                          | b + c <= a                               |
| 22   |         |                                          | c + a <= b                               |
| 23   |         |                                          | a == b                                   |
| 24   |         |                                          | b == c                                   |
| 25   |         |                                          | c == a                                   |
| 26   | 等腰三角形   | (I.1) 且 (I.13) 且 a == b 且 b != c         | (V.1)                                    |
| 27   |         | (I.1) 且 (I.13) 且 b == c 且 c != a         | (V.2)                                    |
| 28   |         | (I.1) 且 (I.13) 且 c == a 且 a != b         | (V.3)                                    |
| 29   |         |                                          | (V.4)                                    |
| 30   |         |                                          | (V.5)                                    |
| 31   |         |                                          | (V.6)                                    |
| 32   |         |                                          | (I.20)                                   |
| 33   |         |                                          | (I.21)                                   |
| 34   |         |                                          | (I.22)                                   |
| 35   |         |                                          | a == b 且 b == c                          |
| 36   |         |                                          | a != b 且 b != c 且 c != a                 |
| 37   | 等边三角形   | (I.1) 且 (I.13) 且 (I.35)                  | (V.1)                                    |
| 38   |         |                                          | (V.2)                                    |
| 39   |         |                                          | (V.3)                                    |
| 40   |         |                                          | (V.4)                                    |
| 41   |         |                                          | (V.5)                                    |
| 42   |         |                                          | (V.6)                                    |
| 43   |         |                                          | (I.20)                                   |
| 44   |         |                                          | (I.21)                                   |
| 45   |         |                                          | (I.22)                                   |
| 46   |         |                                          | a != b                                   |
| 47   |         |                                          | b != c                                   |

乍一看 47 行很吓人，但是实际上排除重复引用以及空单元格，只有 14 个有效等价类与 12 个无效等价类。

## 设计测试用例

当系统的异常输出也被考虑为合法输出加以利用时，一般测试与健壮测试等价。

因为任何的测试用例都一定落在一个有效等价类以及若干个无效等价类中，而且很难（基本不可能）保证一个测试用例只能覆盖一个无效等价类。例如上述的 (I.23) 与 (I.24) 就一定包含了 (I.35)，如果一个测试用例覆盖了 (I.35) 则它一定覆盖了 (I.23) 与 (I.24)。

> 关于一个测试用例应该覆盖多少等价类的思考：
>
> 大前提是设计的测试用例集能覆盖所有的等价类。
>
> 在此前提之下，如果一个测试用例覆盖的等价类越少，一旦测试失败，能给出的调试信息就越多，越容易修复；
>
> 反之，如果一个测试用例覆盖的等价类越多，就需要设计越少的测试用例，可以节约测试的工作量。

所以应该改变测试等价类的策略：一个用例只覆盖一个有效等价类，同时测试有效等价类与无效等价类。

设计测试用例以覆盖 14 个有效等价类：

| 测试用例(a ,b ,c) | 预期输出    | 覆盖有效等价类 |
| ------------- | ------- | ------- |
| (0, 50, 50)   | 参数不合法   | (V.1)   |
| (101, 50, 50) | 参数不合法   | (V.2)   |
| (50, 0, 50)   | 参数不合法   | (V.3)   |
| (50, 101, 50) | 参数不合法   | (V.4)   |
| (50, 50, 0)   | 参数不合法   | (V.5)   |
| (50, 50, 101) | 参数不合法   | (V.6)   |
| (1, 1, 2)     | 不能构成三角形 | (V.7)   |
| (2, 1, 1)     | 不能构成三角形 | (V.8)   |
| (1, 2, 1)     | 不能构成三角形 | (V.9)   |
| (3, 4, 5)     | 一般三角形   | (V.14)  |
| (3, 3, 4)     | 等腰三角形   | (V.26)  |
| (3, 4, 4)     | 等腰三角形   | (V.27)  |
| (3, 4, 3)     | 等腰三角形   | (V.28)  |
| (3, 3, 3)     | 等边三角形   | (V.37)  |



